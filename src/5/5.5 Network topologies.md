## 5.5 拓扑网

根据应用程序的需求，IEEE 802.15.4 LR-WPAN可以在两种拓扑中操作:星型拓扑或对等拓扑。如图5-1所示。在星型拓扑中，设备和一个称为PAN协调器的单一中心节点之间建立通信。设备通常具有一些相关的应用程序，并且是网络通信的起始点或终止点。PAN协调器是PAN的主要控制器。

在任意一种拓扑结构的网络上运行的所有设备都有惟一的地址，称为扩展地址。此外，可以在关联过程中为设备分配一个**短地址**。设备将使用扩展地址或短地址在PAN内进行通信。对于RFD-TX设备，扩展地址字段和短地址字段的传输是可选的。PAN协调器通常由电源供电，而设备可能由电池供电。受益于星型拓扑结构的应用程序包括家庭自动化、个人计算机\(PC\)外围设备、游戏和个人医疗保健。

<div align=center>![](/image/5-1.png)

对等拓扑还具有PAN协调器;但是，它与星型拓扑的不同之处在于，任何设备都可以与任何其他设备通信，只要它们彼此之间处于一定的范围内。对等拓扑允许实现更复杂的网络结构，如mesh网络拓扑。
工业控制和监视、无线传感器网络、资产和库存跟踪、智能农业和安全等应用程序将受益于这种网络拓扑。对等网络允许多个跃点将消息从任何设备路由到网络上的任何其他设备。这些函数可以在更高的层添加，但是它们不是这个标准的一部分。

每个独立的PAN选择唯一的标识符。这个PAN标识符(ID)允许使用短地址在网络中的设备之间通信，并允许跨独立网络的设备之间传输。选择标识符的机制不在本标准范围之内。

网络的形成是由较高层执行的，这不是本标准的一部分。


### 5.5.1 星型网络
星形网络的基本结构如图5-1所示。FFD激活后，可以建立自己的网络，成为PAN协调器。所有的星形网络独立于目前运行的所有其他星形网络运行。这是通过选择一个PAN ID来实现的，PAN ID目前不在无线电通信范围内的任何其他网络中使用。一旦选择了PAN ID, PAN协调器允许其他设备(可能包括ffd和rfd)加入其网络。上层可以使用6.3和6.4中描述的过程来形成星形网络。RFD-RX还可以作为RFD-TXs的PAN协调器终止点。

时间点通道跳变Timeslotted channel hopping(TSCH) pan是拓扑独立的，可以用于星型拓扑以及部分或全部网格拓扑。

低能耗，关键基础设施监控LECIM网络主要在星型拓扑中运行。LECIM网络在能源供应和能力方面通常是不对称的，具有一个由市电供电(或以其他方式提供大量电源)和能源和/或成本受限的设备的PAN协调器。PAN协调器通常比设备更频繁地监视通道。设备休眠，除非它有数据帧要发送。

### 5.5.2 对等网络
在对等拓扑结构中，每个设备都可以与在无线通信范围内的其它任何设备进行通信。任何一个设备都可以定义为 PAN 主协调器，例如，可将信道中第一个通信的设备定义为 PAN 主协调器。未来的网络结构可能不仅仅局限为对等拓扑结构，对拓扑结构进行限制也是可能的。

例如，树簇拓扑结构是对等网络拓扑结构的一种应用形式，在对等网络中的设备可以为完整功能设备，也可以为简化功能设备。 而在树簇中的大部分设备是 FFD， RFD 只能作为一个叶结点连接在树簇拓扑结构树枝的末尾处，这主要是由于 RFD 一次只能连接一个 FFD。任何一个 FFD 都可以作为主协调器，并且，为其它从设备或主设备提供同步服务。在整个 PAN 中，只要该设备相对于 PAN 中的其它设备具有更丰富的计算资源，这样的设备都可以成为该 PAN 的主协调器。在建立一个 PAN 时，首先， PAN 主协调器将自身设置为一个簇标识符（CID）为 0 的簇头，然后，选择一个没有使用的 PAN 标识符，并向邻近的其它设备以广播的方式发送信标帧，从而形成第一簇网络。接收到信标帧的候选设备可以在簇头中请求加入该网络，如果 PAN 主协调器允许该设备加入，那么主协调器会将该设备作为结点加入到邻近表中，成为该网络的一个从设备，同时，请求加入的设备将 PAN 协调器作为它的父结点加到邻近列表中，成为该网络的一个从设备，开始发送周期性的信标帧；其它的候选设备也可以在这台刚加入的设备上加入该网络。如果原始的候选不能加入到该网络中，那么它将寻找其它的父结点。在 6.3 节和 6.4 节中将详细描述一个 PAN 是如何启动的、以及设备是如何加入到 PAN 中的。

最简单的网络结构是只有一个簇的网络，但是多数网络结构由多个相邻的网络构成。一旦第一簇满足预定的应用或网络需求时， PAN 主协调器将会指定一个从设备为另一簇新网络的簇头，使得该从设备成为另一个 PAN 的主协调器，随后其它的从设备将逐个加入，形成一个多簇网络，如图2所示。图中的直线表示设备间的父子关系而不是通信流。多簇网络结构的优点在于增加网络的覆盖范围，但随之而来的缺点是会增加传输信息的延迟时间。

<div align=center>![](/image/5-2.png)

<center>图5-2 聚类树网络</center>

> 笔记
1. FFD和RFD的区别：
FFD 设备可提供全部的 IEEE 802.15.4 MAC 服务，可充当任何 ZigBee 设备，因此 FFD 设备不仅可以发送和接收数据，还具备路由功能；
而 RFD设备只提供部分的 IEEE 802.15.4 MAC 服务，只能充当终端节点，不能充当协调点和路由节点，因此它只负责将采集的数据信息发送给协调点和路由节点，并不具备数据转发、路由发现和路由维护等功能
2. 图中的直线表示设备间的父子关系而不是通信流。多簇网络结构的优点在于增加网络的覆盖范围，但随之而来的缺点是会增加传输信息的延迟时间。
一般依据硬件资源来设置FFD或RFD，图中3是FFD,10,22是RFD。

TMCTP是集群树网络的一种形式，其中SPC是整体PAN协调器，为集群中的其他PAN协调器提供同步服务。SPC还可以访问地理位置数据库(GDB)服务器，向其他PAN协调器提供TVWS频道可用性信息。图5-3显示了一个示例。在TMCTP中，集群之间的冲突可以减少，因为每个集群使用自己的通道;此外，通过TMCTP父子结构可以增加覆盖率。每个TMCTP-parent锅协调员,包括SPC,与它TMCTP-child PAN协调员的上限或CFP TMCTP-parent锅协调员超帧和接收信标帧的TMCTP-child PAN协调员在专用通道专用插槽灯塔(DBS)分配给他们在防喷器,如图所示用星号(*)如图5 - 3所示。

<div align=center>![](/image/5-3.png)
