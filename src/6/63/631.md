## 6.3 启动和维护PANs

### 6.3.1 扫描信道
　　除了RFD-RX和RFD-TX设备之外，所有设备都应该能够跨指定的一组通道执行被动扫描和孤立信道扫描。此外，FFD应该能够执行能量检测(ED)和主动扫描。FFD可以选择性地执行增强的活动扫描。

　　设备通过 MLME-SCAN.request 原语(参考 8.2.11.1 节)开始对信道的扫描。设备以信道号由低到高的顺序逐个扫描信道。在扫描期间，设备停止信标传输，并且只接受物理层上与正在进行的扫描有关的数据服务的帧。对于 UWB PHY 和 CSS PHY，适用于指定信道的所有先导码都会被扫描。扫描结束后，(信标使能的 PAN 网络的)协调器将重新开始信标传输。扫描结果通过 MLME-SCAN.confirm 原语(参考 8.2.11.2 节)返回。

#### 6.3.1.1 能量检测（ED）信道扫描
　　设备可以通过能量检测扫描获得每一个被扫描信道的能量峰值。未来的 PAN 协调器可利用这个信息，在选择一个最合适的信道后，启动一个新的 PAN 协调器。在能量检测扫描期间， MAC层将丢弃所有物理层数据服务传来的帧信息。

　　设备通过 MLME-SCAN.request 原语可以发出对指定的一组信道进行能量检测扫描的请求，原语中的 ScanType 参数指明能量检测扫描。对于每一个信道， MLME 首先通过设置相应的 _phyCurrentChannel_ 和 _phyCurrentPage _切换到此信道，然后在 _[aBaseSuperframeDuration × (2<sup>n</sup> + 1)]_ 期间内重复地对信道进行能量检测，其中 n 表示 MLME-SCAN.request 原语中 ScanDuration 参数的值。对某一信道的扫描结束后，设备需要记住在此期间所获得的最大的 ED 值，然后再切换到信道列表中的下一个信道继续扫描。设备应当至少能存储一个信道 ED 值(译注：在实现该标准的具体代码中，可以指定设备最多可以存储多少个 ED 值)。

　　当设备存储的信道 ED 值的个数达到所指定的最大值，或者所指定的每一个信道都被测量后，能量检查扫描结束。

#### 6.3.1.2 主动扫描和被动扫描
　　设备可以通过主动扫描或被动扫描对其无线通信范围内的协调器进行定位。主动扫描时，设备通过信标请求命令主动从协调器获取一个信标；被动扫描时，设备不会发生信标请求命令(译注：而是等待协调器发送的周期性信标)。图 6-14 和图 6-15 分别描述了主动扫描和被动扫描的消息流程图。

　　在主动/被动扫描期间，MAC 子层将丢弃来自物理层数据服务的所有非信标帧。如果设备接收到了信标帧，但是在该帧的未处理地址列表中包含该设备的地址，那么该设备就不应该尝试从该帧中提取未处理的数据。

　　~~在开始主动/被动扫描前，MAC 子层应当临时存储 macPANId 的值，并在扫描期间将其设置为 0xffff。这样做能使接收滤波器能接收到所有的信标，而不仅仅是它当前所属 PAN 网络的信标(参考 5.1.6.2 节)。扫描完成后，MAC 子层应当将 macPANId 的值恢复为所储存的扫描前的值。~~

<div align=center>![](/image/6-14.png)